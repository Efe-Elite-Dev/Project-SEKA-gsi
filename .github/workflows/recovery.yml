name: A04s Elite TWRP - Touch Interface V28

on:
  workflow_dispatch:

jobs:
  build_twrp:
    runs-on: ubuntu-latest
    permissions: contents: write

    steps:
      - name: Checkout
        uses: actions/checkout@v4

      - name: Tools Setup
        run: |
          sudo apt-get update
          sudo apt-get install -y python3-pip wget curl p7zip-full
          pip install --break-system-packages gdown

      - name: Get Official MagiskBoot
        run: |
          wget https://github.com/topjohnwu/Magisk/releases/download/v27.0/Magisk-v27.0.apk
          7z e Magisk-v27.0.apk "lib/x86_64/libmagiskboot.so"
          mv libmagiskboot.so magiskboot
          chmod +x magiskboot

      - name: Download Stock and TWRP Base
        run: |
          # 1. Senin orijinal recovery imajÄ±n (Kernel buradan gelecek)
          gdown "https://drive.google.com/uc?id=1qofFuiUshTQTZx7qUhPgIW8c3GOpvGdh" -O stock_recovery.img
          
          # 2. A04s uyumlu BASE TWRP (ArayÃ¼z buradan gelecek)
          # NOT: Buraya Ã§alÄ±ÅŸan bir TWRP linki lazÄ±m. Ã–rnek olarak bir placeholder koyuyorum:
          curl -L "https://github.com/VocaloidWorld1/Project-SEKA-gsi/raw/main/base_twrp.img" -o twrp_base.img || touch twrp_base.img

      - name: Porting Process (Kernel Swap)
        run: |
          # Orijinal recovery'yi parÃ§ala (Kernel'i al)
          ./magiskboot unpack stock_recovery.img
          mv kernel stock_kernel
          rm -rf ramdisk.cpio dtb
          
          # TWRP Base'i parÃ§ala (Ramdisk'i al)
          ./magiskboot unpack twrp_base.img
          
          # TWRP'nin ramdisk'ine senin stock kernelini tak
          mv stock_kernel kernel
          
          # TWRP arayÃ¼zÃ¼nÃ¼ senin kernelinle paketle
          ./magiskboot repack twrp_base.img elite_twrp.img

      - name: Create Odin Tar
        run: |
          mv elite_twrp.img recovery.img
          tar -cvf A04s-Elite-TWRP-V28.tar recovery.img

      - name: Release TWRP
        uses: softprops/action-gh-release@v1
        with:
          files: A04s-Elite-TWRP-V28.tar
          tag_name: twrp-v28-touch
          name: "A04s Elite TWRP V28 - Touch Interface"
          body: "Aga, sonunda Install butonlu, dokunmatik arayÃ¼zlÃ¼ TWRP hazÄ±r! ðŸŽ¹ðŸ”¥"
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
