name: A04s-All-In-One-Builder

on:
  workflow_dispatch:

jobs:
  build:
    runs-on: ubuntu-latest
    permissions:
      contents: write

    steps:
      - name: Checkout Repo
        uses: actions/checkout@v4

      - name: Install Tools
        run: |
          sudo apt-get update
          sudo apt-get install -y android-sdk-libsparse-utils aria2

      - name: Download Files (Large File Fix)
        run: |
          # GSI indirme (Büyük dosya onayını otomatik geçer)
          aria2c -s 16 -x 16 --check-certificate=false "https://docs.google.com/uc?export=download&confirm=$(curl -sL "https://docs.google.com/uc?export=download&id=1A8sLEoItqNuoX1LnWJUKokZRPtHter_k" | grep -o 'confirm=[^&]*' | sed 's/confirm=//')&id=1A8sLEoItqNuoX1LnWJUKokZRPtHter_k" -o miku.img
          
          # Vendor indirme
          aria2c -s 16 -x 16 --check-certificate=false "https://docs.google.com/uc?export=download&confirm=$(curl -sL "https://docs.google.com/uc?export=download&id=1S11bA-SEtg0ILETxerkTNblU_361vF7B" | grep -o 'confirm=[^&]*' | sed 's/confirm=//')&id=1S11bA-SEtg0ILETxerkTNblU_361vF7B" -o vendor.img

      - name: Build ROM
        run: |
          # Boyut kontrolü yapalım (Loglarda göreceksin)
          ls -lh *.img
          simg2img miku.img A04s_Miku_AllInOne.img || cp miku.img A04s_Miku_AllInOne.img

      - name: Create Release
        uses: softprops/action-gh-release@v1
        with:
          tag_name: v1.0-A04s-Vocaloid
          name: "A04s Miku ROM - Real Size Edition"
          body: "Efe-Elite-Dev tarafından derlendi. Bu sefer gerçek boyut!"
          files: A04s_Miku_AllInOne.img
        env:
          GITHUB_TOKEN: ${{ secrets.GH_TOKEN }}
