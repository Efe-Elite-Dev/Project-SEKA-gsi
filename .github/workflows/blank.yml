name: A04s-All-In-One-Builder

on:
  workflow_dispatch:

jobs:
  build:
    runs-on: ubuntu-latest
    permissions:
      contents: write

    steps:
      - name: Checkout Repo
        uses: actions/checkout@v4

      - name: Download Files (Force Big File)
        run: |
          # Miku GSI indirme (Onay kodunu alarak)
          wget --load-cookies /tmp/cookies.txt "https://docs.google.com/uc?export=download&confirm=$(wget --quiet --save-cookies /tmp/cookies.txt --keep-session-cookies --no-check-certificate 'https://docs.google.com/uc?export=download&id=1A8sLEoItqNuoX1LnWJUKokZRPtHter_k' -O- | sed -rn 's/.*confirm=([0-9A-Za-z_]+).*/\1\n/p')&id=1A8sLEoItqNuoX1LnWJUKokZRPtHter_k" -O miku.img && rm -rf /tmp/cookies.txt
          
          # Vendor indirme (Onay kodunu alarak)
          wget --load-cookies /tmp/cookies.txt "https://docs.google.com/uc?export=download&confirm=$(wget --quiet --save-cookies /tmp/cookies.txt --keep-session-cookies --no-check-certificate 'https://docs.google.com/uc?export=download&id=1S11bA-SEtg0ILETxerkTNblU_361vF7B' -O- | sed -rn 's/.*confirm=([0-9A-Za-z_]+).*/\1\n/p')&id=1S11bA-SEtg0ILETxerkTNblU_361vF7B" -O vendor.img && rm -rf /tmp/cookies.txt

      - name: Check Size
        run: |
          # Burada dosya boyutunu kontrol ediyoruz
          ls -lh *.img
          echo "Efe, eğer burada 2.0G veya benzeri görüyorsan başardık!"

      - name: Build ROM
        run: |
          # Sparse'tan çevir veya kopyala
          sudo apt-get update && sudo apt-get install -y android-sdk-libsparse-utils
          simg2img miku.img A04s_Miku_AllInOne.img || cp miku.img A04s_Miku_AllInOne.img

      - name: Create Release
        uses: softprops/action-gh-release@v1
        with:
          tag_name: v1.0-A04s-Real
          name: "A04s Miku ROM - Real Size"
          body: "22 Şubat 2012 doğumlu Efe'den dev build! Bu sefer 2KB değil, gerçek boyut!"
          files: A04s_Miku_AllInOne.img
        env:
          GITHUB_TOKEN: ${{ secrets.GH_TOKEN }}
