name: ðŸš€ GSI Pixel-Poco Drive Builder v1.8.0.129

on:
  workflow_dispatch: # Butonla baÅŸlatmak iÃ§in

permissions:
  contents: write

jobs:
  build-and-release:
    runs-on: ubuntu-latest
    steps:
      - name: ðŸ“¥ Repo Checkout
        uses: actions/checkout@v4

      - name: ðŸ› ï¸ GSI & Drive Tools Kurulumu
        run: |
          sudo apt-get update
          sudo apt-get install -y simg2img img2simg e2fsprogs python3-pip
          pip3 install gdown

      - name: ðŸ“¥ Launcher3 APK'yÄ± Drive'dan Ä°ndir
        run: |
          # Senin verdiÄŸin Google Drive linkindeki dosyayÄ± Ã§ekiyoruz
          gdown --id 1eM7cDCfwu0zortgrjKY_8qkeinUpCu61 -O Launcher3.apk

      - name: ðŸ—ï¸ GSI Modifikasyon (Pixel 9 & POCO)
        run: |
          # KlasÃ¶rdeki .img dosyasÄ±nÄ± bul (Reponda bir .img olmalÄ±)
          GSI_FILE=$(ls *.img | head -n 1)
          
          # ImajÄ± dÃ¼zenlenebilir hale getir
          simg2img "$GSI_FILE" system_raw.img || mv "$GSI_FILE" system_raw.img
          mkdir -p mount_point
          sudo mount -o loop system_raw.img mount_point

          # TWEAK ENJEKSÄ°YONU
          echo "Pixel 9 Pro kimliÄŸi ve POCO hÄ±z ayarlarÄ± gÃ¶mÃ¼lÃ¼yor..."
          sudo bash -c "echo 'ro.product.model=Pixel 9 Pro' >> mount_point/system/build.prop"
          sudo bash -c "echo 'ro.product.brand=google' >> mount_point/system/build.prop"
          sudo bash -c "echo 'persist.sys.pixel_photos=true' >> mount_point/system/build.prop"
          sudo bash -c "echo 'ro.config.low_ram=false' >> mount_point/system/build.prop"

          # Drive'dan gelen Launcher3'Ã¼ sisteme gÃ¶m
          if [ -f Launcher3.apk ]; then
            sudo mkdir -p mount_point/system/priv-app/Launcher3
            sudo cp Launcher3.apk mount_point/system/priv-app/Launcher3/Launcher3.apk
            sudo chmod 644 mount_point/system/priv-app/Launcher3/Launcher3.apk
          fi

          # Kapat ve SÄ±kÄ±ÅŸtÄ±r
          sudo umount mount_point
          img2simg system_raw.img PJSK_Pixel9_Poco_GSI_v1.8.0.129.img
          echo "TAG_NAME=v1.8.0.129-$(date +'%Y%m%d%H%M')" >> $GITHUB_ENV

      - name: ðŸ†™ GitHub Release OluÅŸtur ve YÃ¼kle
        uses: softprops/action-gh-release@v1
        with:
          tag_name: ${{ env.TAG_NAME }}
          name: "ðŸš€ PJSK Drive-Integrated GSI v1.8.0.129"
          body: |
            ### Samsung A04s Pixel-Poco GSI (v1.8.0.129)
            - **Launcher:** Google Drive'dan otomatik Ã§ekildi.
            - **Google FotoÄŸraflar:** SÄ±nÄ±rsÄ±z yedekleme aktif.
            - **HÄ±z:** POCO Turbo Tweakleri uygulandÄ±.
          files: PJSK_Pixel9_Poco_GSI_v1.8.0.129.img
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
