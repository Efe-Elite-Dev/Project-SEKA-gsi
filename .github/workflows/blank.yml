name: A04s-All-In-One-Builder

on:
  workflow_dispatch:

jobs:
  build:
    runs-on: ubuntu-latest
    permissions:
      contents: write

    steps:
      - name: Checkout Repo
        uses: actions/checkout@v4

      - name: Download Files (Google Drive Security Bypass)
        run: |
          # Miku GSI (GerÃ§ek GB Boyutu Ä°Ã§in)
          wget --load-cookies /tmp/cookies.txt "https://docs.google.com/uc?export=download&confirm=$(wget --quiet --save-cookies /tmp/cookies.txt --keep-session-cookies --no-check-certificate 'https://docs.google.com/uc?export=download&id=1A8sLEoItqNuoX1LnWJUKokZRPtHter_k' -O- | sed -rn 's/.*confirm=([0-9A-Za-z_]+).*/\1\n/p')&id=1A8sLEoItqNuoX1LnWJUKokZRPtHter_k" -O miku.img && rm -rf /tmp/cookies.txt
          
          # Vendor (GerÃ§ek GB Boyutu Ä°Ã§in)
          wget --load-cookies /tmp/cookies.txt "https://docs.google.com/uc?export=download&confirm=$(wget --quiet --save-cookies /tmp/cookies.txt --keep-session-cookies --no-check-certificate 'https://docs.google.com/uc?export=download&id=1S11bA-SEtg0ILETxerkTNblU_361vF7B' -O- | sed -rn 's/.*confirm=([0-9A-Za-z_]+).*/\1\n/p')&id=1S11bA-SEtg0ILETxerkTNblU_361vF7B" -O vendor.img && rm -rf /tmp/cookies.txt

      - name: Check Real Size
        run: |
          # Burada 1G, 2G gibi deÄŸerler gÃ¶rmeliyiz
          ls -lh *.img

      - name: Build ROM
        run: |
          sudo apt-get update && sudo apt-get install -y android-sdk-libsparse-utils
          simg2img miku.img A04s_Miku_AllInOne.img || cp miku.img A04s_Miku_AllInOne.img

      - name: Create Miku Release
        uses: softprops/action-gh-release@v1
        with:
          tag_name: "v2.0-A04s-RealSize"
          name: "A04s Miku ROM - GERÃ‡EK BOYUT"
          body: "Efe-Elite-Dev: Bu sefer 2KB deÄŸil, gerÃ§ek Gigabaytlar burada! ðŸŽ¹ðŸ”¥"
          files: A04s_Miku_AllInOne.img
        env:
          GITHUB_TOKEN: ${{ secrets.GH_TOKEN }}
